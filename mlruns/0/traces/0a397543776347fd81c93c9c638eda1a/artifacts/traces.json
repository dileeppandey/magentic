{"spans": [{"name": "ChatDatabricks", "context": {"span_id": "f056441d95c0648f", "trace_id": "e7c75296cb71fcc6e33441fa41e0cbbf"}, "parent_id": null, "start_time": 1749502816260709000, "end_time": 1749502816883206000, "status_code": "ERROR", "status_message": "400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations. Response text: {\"error_code\": \"BAD_REQUEST\", \"message\": \"Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\\n\"}", "attributes": {"mlflow.traceRequestId": "\"0a397543776347fd81c93c9c638eda1a\"", "mlflow.spanType": "\"CHAT_MODEL\"", "mlflow.spanInputs": "[[{\"content\": \"# Travel Summary\\n## Introduction\\nTo provide a personalized travel summary, I would like to know more about your travel plans. \\n## Next Steps\\nPlease let me know your destination, travel dates, and any specific preferences or requirements you may have, such as accessibility features or budget constraints. \\n## Follow-up Questions\\n* What is your desired destination? \\n* What are your travel dates? \\n* Do you have any specific airline or hotel preferences? \\n* Are there any accessibility features you require?\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"example\": false, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Give me travel details to Tokyo on July 5th\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null, \"example\": false}]]", "invocation_params": "{\"model\": \"databricks-meta-llama-3-3-70b-instruct\", \"target_uri\": \"databricks\", \"n\": 1, \"extra_params\": {}, \"_type\": \"chat-databricks\", \"stop\": null}", "options": "{\"stop\": null}", "batch_size": "1", "metadata": "{\"ls_provider\": \"databricks\", \"ls_model_type\": \"chat\", \"ls_model_name\": \"databricks-meta-llama-3-3-70b-instruct\"}", "mlflow.chat.messages": "[{\"role\": \"assistant\", \"content\": \"# Travel Summary\\n## Introduction\\nTo provide a personalized travel summary, I would like to know more about your travel plans. \\n## Next Steps\\nPlease let me know your destination, travel dates, and any specific preferences or requirements you may have, such as accessibility features or budget constraints. \\n## Follow-up Questions\\n* What is your desired destination? \\n* What are your travel dates? \\n* Do you have any specific airline or hotel preferences? \\n* Are there any accessibility features you require?\"}, {\"role\": \"user\", \"content\": \"Give me travel details to Tokyo on July 5th\"}]"}, "events": [{"name": "exception", "timestamp": 1749502816882994, "attributes": {"exception.message": "400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations. Response text: {\"error_code\": \"BAD_REQUEST\", \"message\": \"Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\\n\"}", "exception.type": "HTTPError", "exception.stacktrace": "Traceback (most recent call last):\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/utils/request_utils.py\", line 63, in augmented_raise_for_status\n    response.raise_for_status()\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/requests/models.py\", line 1026, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py\", line 1094, in _agenerate_with_cache\n    result = await self._agenerate(\n             ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py\", line 1134, in _agenerate\n    return await run_in_executor(\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/runnables/config.py\", line 616, in run_in_executor\n    return await asyncio.get_running_loop().run_in_executor(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/.pyenv/versions/3.11.9/lib/python3.11/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/runnables/config.py\", line 607, in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/databricks_langchain/chat_models.py\", line 283, in _generate\n    resp = self.client.predict(endpoint=self.model, inputs=data)  # type: ignore\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/deployments/databricks/__init__.py\", line 239, in predict\n    return self._call_endpoint(\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/deployments/databricks/__init__.py\", line 148, in _call_endpoint\n    augmented_raise_for_status(response)\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/utils/request_utils.py\", line 66, in augmented_raise_for_status\n    raise HTTPError(\nrequests.exceptions.HTTPError: 400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations. Response text: {\"error_code\": \"BAD_REQUEST\", \"message\": \"Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\\n\"}"}}]}], "request": "[[{\"content\": \"# Travel Summary\\n## Introduction\\nTo provide a personalized travel summary, I would like to know more about your travel plans. \\n## Next Steps\\nPlease let me know your destination, travel dates, and any specific preferences or requirements you may have, such as accessibility features or budget constraints. \\n## Follow-up Questions\\n* What is your desired destination? \\n* What are your travel dates? \\n* Do you have any specific airline or hotel preferences? \\n* Are there any accessibility features you require?\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"example\": false, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"Give me travel details to Tokyo on July 5th\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null, \"example\": false}]]", "response": null}