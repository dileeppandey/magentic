{"spans": [{"name": "ChatDatabricks", "context": {"span_id": "1e28e31d5cb841b2", "trace_id": "4f25ec0339924dadd8c3ebb0551ab315"}, "parent_id": null, "start_time": 1749502255131286000, "end_time": 1749502255298168000, "status_code": "ERROR", "status_message": "400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations. Response text: {\"error_code\": \"BAD_REQUEST\", \"message\": \"Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\\n\"}", "attributes": {"mlflow.traceRequestId": "\"782288c3ad0f437490d981ee5a735a99\"", "mlflow.spanType": "\"CHAT_MODEL\"", "mlflow.spanInputs": "[[{\"content\": \"# Los Angeles Travel Summary\\nThe 4th of July in Los Angeles is expected to be sunny with high temperatures. \\n## Options\\n- **Flights**: Various airlines offer flights to Los Angeles, with prices starting from $200. Please let us know your preferred departure city and dates to get a more accurate quote. Some flights offer accessibility features such as wheelchair access and priority boarding.\\n- **Hotels**: We can suggest hotels in different areas of LA, including Downtown, Hollywood, and Beverly Hills. Prices start from $150 per night. Please let us know your preferred area, budget, and accessibility requirements to get a tailored list of options. Some hotels offer accessibility features such as service animal friendly rooms, visual/hearing accessibility, and wheelchair access.\\n## Next Steps\\nTo provide you with the best options, could you please provide your preferred area in LA, accessibility requirements, budget constraints, and any preferred hotel chains or amenities you're looking for?\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"example\": false, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"My budget is 100$\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null, \"example\": false}]]", "invocation_params": "{\"model\": \"databricks-meta-llama-3-3-70b-instruct\", \"target_uri\": \"databricks\", \"n\": 1, \"extra_params\": {}, \"_type\": \"chat-databricks\", \"stop\": null}", "options": "{\"stop\": null}", "batch_size": "1", "metadata": "{\"ls_provider\": \"databricks\", \"ls_model_type\": \"chat\", \"ls_model_name\": \"databricks-meta-llama-3-3-70b-instruct\"}", "mlflow.chat.messages": "[{\"role\": \"assistant\", \"content\": \"# Los Angeles Travel Summary\\nThe 4th of July in Los Angeles is expected to be sunny with high temperatures. \\n## Options\\n- **Flights**: Various airlines offer flights to Los Angeles, with prices starting from $200. Please let us know your preferred departure city and dates to get a more accurate quote. Some flights offer accessibility features such as wheelchair access and priority boarding.\\n- **Hotels**: We can suggest hotels in different areas of LA, including Downtown, Hollywood, and Beverly Hills. Prices start from $150 per night. Please let us know your preferred area, budget, and accessibility requirements to get a tailored list of options. Some hotels offer accessibility features such as service animal friendly rooms, visual/hearing accessibility, and wheelchair access.\\n## Next Steps\\nTo provide you with the best options, could you please provide your preferred area in LA, accessibility requirements, budget constraints, and any preferred hotel chains or amenities you're looking for?\"}, {\"role\": \"user\", \"content\": \"My budget is 100$\"}]"}, "events": [{"name": "exception", "timestamp": 1749502255298023, "attributes": {"exception.message": "400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations. Response text: {\"error_code\": \"BAD_REQUEST\", \"message\": \"Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\\n\"}", "exception.type": "HTTPError", "exception.stacktrace": "Traceback (most recent call last):\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/utils/request_utils.py\", line 63, in augmented_raise_for_status\n    response.raise_for_status()\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/requests/models.py\", line 1026, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py\", line 1094, in _agenerate_with_cache\n    result = await self._agenerate(\n             ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/language_models/chat_models.py\", line 1134, in _agenerate\n    return await run_in_executor(\n           ^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/runnables/config.py\", line 616, in run_in_executor\n    return await asyncio.get_running_loop().run_in_executor(\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/.pyenv/versions/3.11.9/lib/python3.11/concurrent/futures/thread.py\", line 58, in run\n    result = self.fn(*self.args, **self.kwargs)\n             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/langchain_core/runnables/config.py\", line 607, in wrapper\n    return func(*args, **kwargs)\n           ^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/databricks_langchain/chat_models.py\", line 283, in _generate\n    resp = self.client.predict(endpoint=self.model, inputs=data)  # type: ignore\n           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/deployments/databricks/__init__.py\", line 239, in predict\n    return self._call_endpoint(\n           ^^^^^^^^^^^^^^^^^^^^\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/deployments/databricks/__init__.py\", line 148, in _call_endpoint\n    augmented_raise_for_status(response)\n  File \"/Users/dpandey/Developer/databricks-hackathon/.venv/lib/python3.11/site-packages/mlflow/utils/request_utils.py\", line 66, in augmented_raise_for_status\n    raise HTTPError(\nrequests.exceptions.HTTPError: 400 Client Error: Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\n for url: dbc-f5808195-a4d5.cloud.databricks.com/serving-endpoints/databricks-meta-llama-3-3-70b-instruct/invocations. Response text: {\"error_code\": \"BAD_REQUEST\", \"message\": \"Bad request: rpc error: code = InvalidArgument desc = Chat message input roles must alternate (user -> assistant -> u -> a -> ...) with an optional system at the start. Tool messages are optional and must follow a preceding assistant message containing tool calls.\\n\"}"}}]}], "request": "[[{\"content\": \"# Los Angeles Travel Summary\\nThe 4th of July in Los Angeles is expected to be sunny with high temperatures. \\n## Options\\n- **Flights**: Various airlines offer flights to Los Angeles, with prices starting from $200. Please let us know your preferred departure city and dates to get a more accurate quote. Some flights offer accessibility features such as wheelchair access and priority boarding.\\n- **Hotels**: We can suggest hotels in different areas of LA, including Downtown, Hollywood, and Beverly Hills. Prices start from $150 per night. Please let us know your preferred area, budget, and accessibility requirements to get a tailored list of options. Some hotels offer accessibility features such as service animal friendly rooms, visual/hearing accessibility, and wheelchair access.\\n## Next Steps\\nTo provide you with the best options, could you please provide your preferred area in LA, accessibility requirements, budget constraints, and any preferred hotel chains or amenities you're looking for?\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"ai\", \"name\": null, \"id\": null, \"example\": false, \"tool_calls\": [], \"invalid_tool_calls\": [], \"usage_metadata\": null}, {\"content\": \"My budget is 100$\", \"additional_kwargs\": {}, \"response_metadata\": {}, \"type\": \"human\", \"name\": null, \"id\": null, \"example\": false}]]", "response": null}